{% extends 'base_venta.html' %}

{% block content %}
<head>
    <!-- CSS de DataTables -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.0.1/css/buttons.dataTables.min.css">

    <!-- JS de DataTables -->
    <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.0.1/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.flash.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.html5.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.print.min.js"></script>
</head>

<h1>Lista de Ventas</h1>

<form method="get" class="mb-3">
    <div class="row">
        <div class="col">
            <input type="text" name="q" class="form-control" placeholder="Buscar por cliente, producto o ID" value="{{ query }}">
        </div>
        <div class="col">
            <input type="date" name="fecha_desde" class="form-control" placeholder="Fecha desde" value="{{ fecha_desde }}">
        </div>
        <div class="col">
            <input type="date" name="fecha_hasta" class="form-control" placeholder="Fecha hasta" value="{{ fecha_hasta }}">
        </div>
        <div class="col">
            <button type="submit" class="btn btn-primary">Buscar</button>
        </div>
    </div>
</form>


<a href="{% url 'crear_venta' %}" class="btn btn-primary mb-3">Crear Nueva Venta</a>



<!-- Botón para imprimir la lista de ventas -->
<button onclick="Venta()" class="btn btn-primary mb-3">Imprimir Lista de Ventas</button>
<table class="table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Fecha</th>
            <th>Cliente</th>>
            <th>Total</th>
            <th>Productol</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for venta in ventas %}
        <tr>
            <td>{{ venta.id }}</td>
            <td>{{ venta.fecha|date:"d/m/Y" }}</td>
            <td>{{ venta.cliente }}</td>
            <td>{{ venta.producto.nombre|default:"No especificado" }}</td>
            <td>{{ venta.cantidad }}</td>
            <td>${{ venta.precio_unitario|floatformat:2 }}</td>
            <td>${{ venta.total|floatformat:2 }}</td>
            <td>
                <a href="{% url 'editar_venta' venta.id %}" class="btn btn-sm btn-outline-secondary">Editar</a>
                <a href="{% url 'eliminar_venta' venta.id %}" class="btn btn-sm btn-outline-danger">Eliminar</a>
                <a href="{% url 'lista_detalles_venta' venta.id %}" class="btn btn-sm btn-info">Ver</a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="8">No hay ventas registradas.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% if ventas.has_other_pages %}
<nav>
    <ul class="pagination">
        {% if ventas.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ ventas.previous_page_number }}">Anterior</a></li>
        {% endif %}
        {% for i in ventas.paginator.page_range %}
            {% if ventas.number == i %}
                <li class="page-item active"><span class="page-link">{{ i }}</span></li>
            {% else %}
                <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
            {% endif %}
        {% endfor %}
        {% if ventas.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ ventas.next_page_number }}">Siguiente</a></li>
        {% endif %}
    </ul>
</nav>
{% endif %}

<a href="{% url 'admin_dashboard' %}" class="btn btn-primary mb-3">Volver al Panel de Administración</a>
<a href="{% url 'exportar_pdf' %}" class="btn btn-primary mb-3">Generar PDF</a>
<a href="{% url 'exportar_excel' %}" class="btn btn-primary mb-3">Exportar a Excel</a>

<script>
    $(document).ready(function() {
        $('#ventas-table').DataTable({
            dom: 'Bfrtip',
            buttons: [
                'copy', 'csv', 'excel', 'pdf', 'print'
            ]
        });
    });
    </script>
    
    {% block extra_js %}
    <script>
        function Venta() {
            window.print();
        }
    </script>
    {% endblock %}





{% endblock %}

